// Copyright 2015 gRPC authors.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package routeguide;

// 服务器导出的接口
service RouteGuide {
  // 一个简单的RPC。
  //
  // 获取给定位置的特征。
  //
  // 如果给定位置没有特征，则返回一个名称为空的特性。
  rpc GetFeature(Point) returns (Feature) {}

  // 一个服务器到客户端的流式RPC。
  //
  // 获取给定矩形区域内可用的特征。结果以流式传输而不是一次性返回（例如在包含重复字段的响应消息中），
  // 因为矩形可能覆盖大面积区域并包含大量特征。
  rpc ListFeatures(Rectangle) returns (stream Feature) {}

  // 一个客户端到服务器的流式RPC。
  //
  // 接收正在遍历的路线上的一系列Points，在遍历完成后返回RouteSummary。
  rpc RecordRoute(stream Point) returns (RouteSummary) {}

  // 一个双向流式RPC。
  //
  // 接收在路线遍历过程中发送的RouteNotes流，同时接收其他RouteNotes（例如来自其他用户）。
  rpc RouteChat(stream RouteNote) returns (stream RouteNote) {}
}

// 点表示为E7表示法中的纬度-经度对（度数乘以10**7并四舍五入到最接近的整数）。
// 纬度应在+/-90度范围内，经度应在+/-180度范围内（含边界）。
message Point {
  int32 latitude = 1;
  int32 longitude = 2;
}

// 一个纬度-经度矩形，表示为两个对角点"lo"和"hi"。
message Rectangle {
  // 矩形的一个角。
  Point lo = 1;

  // 矩形的另一个角。
  Point hi = 2;
}

// 一个特征在给定点命名某物。
//
// 如果无法命名特征，则名称为空。
message Feature {
  // 特征的名称。
  string name = 1;

  // 检测到特征的点。
  Point location = 2;
}

// RouteNote是在给定点发送的消息。
message RouteNote {
  // 发送消息的位置。
  Point location = 1;

  // 要发送的消息。
  string message = 2;
}

// RouteSummary是对RecordRoute rpc的响应中接收到的摘要信息。
//
// 它包含接收到的单个点的数量、检测到的特征数量以及所覆盖的总距离（作为每个点之间距离的累积和）。
message RouteSummary {
  // 接收到的点的数量。
  int32 point_count = 1;

  // 遍历路线时经过的已知特征数量。
  int32 feature_count = 2;

  // 以米为单位的覆盖距离。
  int32 distance = 3;

  // 遍历的持续时间（以秒为单位）。
  int32 elapsed_time = 4;
}